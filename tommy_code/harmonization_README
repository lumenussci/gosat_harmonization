The intent of this README is to document the various steps required to produce the satellite harmonized data set.

1. <main_1_match_gosat_to_oco2.pro>

   Pick the versions for each satellite and point to the relevant Lite file holdings.
   Set various collocation requirements.
   Generates collocated file and outputs into /data6/ttaylor/data_ttaylor/gosat_oco2_collocations/
   Why is the gain mode string being converted into integer?

2. <main_2_fit_and_plot_collocated_gosat_to_oco2.pro>

   - For the collocated soundings, a GOSAT XCO2 averaging kernel correction (1 or 2 terms) is applied based on the values in the mean OCO-2 (oco_mean_struct).
   - Fits of variable values vs dXCO2 (GOSAT - OCO) are performed for a selected list of variables, e.g., all variables contained in the Lite.retrieval directory or skewed-sine against days.   
   - Perform Lindqvist sinusodial fit versus time.
   - Scatter plots are created of unadjusted dXCO2 vs variable and adjusted dXCO2 vs variable for 3 observation modes.
   - Writes fit coefficients to IDL.SAV file in tropical_iav/data/gosat_vs_oco2_XXX/bc_fit_coefficients/bc_fit_coefficients_VARNAME_Global.SAV
   - Plot of the reduction in dXCO2 vs variables in decreasing ranked order

   TO-DO
   - Truncate time record to complete years?

3. <main_3_harmonize_full_gosat_v9_record.pro>

   A. Copy original GOSAT Lite files into a new data holding, e.g., OutLiteDir='/data8/ttaylor/data_ttaylor/GOSAT/product/Lite/v9c3_r20240422/'
   B. Loop over each of the copied Lite files. 
      - Based on results from (2.), select the variables to use to make the correction for each GOSAT observation mode.
      - Use the IDL.SAV fit coefficients to adjust the GOSAT XCO2 value for each sounding. 
   C. Add the harmonized XCO2 and the magnitude of the adjustment as new data fields in the GOSAT Lite files.

4. <analysis_utilities/generate_lite_save_files/generate_lite_save.pro>

   - Point to the new GOSAT data holding.
   - Make sure the new variable names are in the ReadList. (xco2* works)
   - Generate output IDL.SAVE to, e.g., /data10/data8/ttaylor/data_ttaylor/lite_save_files/gosat/v9c_r20240326/gosat_v9c_r20240326_lite_20090420_20200630_filtered_xmedium.sav

5. <main_4_collocated_gosat_vs_oco2_analysis.pro>

   - Reads in gosat/oco collocated save file.
   - Reads the GOSAT Lite save file containing, among other variables, XCO2 and harmonized XCO2 and adjustment value.
   - Calculates multiple components of averaging kernel correction.
   - Writes matched GOSAT and aggregated OCO data to single output H5 file. Includes AK info. (Deliver to Will).
   - Makes plots of collocation histograms.
   - Makes plots of AK info.
   - Grids dXCO2 (GOSAT-OCO) (either vs lat/lon or vs lat/time). Seasonally or annually. Output written to NetCDF for python plotting.

   TO-DO
   1. Code needs additional cleaning up. Too many levels of filtering and redundant variables.
   2. Loop over View Modes.

6. <main_5_individual_sensor_analysis.pro 
   
   - Grids individual sensors
      Reads in GOSAT Lite save file or OCO super lite save file.
      Uses the aggregated NetCDF file to overwrite the GOSAT XCO2 values if switch set to v9b.
      Grids variables for individual satellite (either vs lat/lon or vs lat/time). Seasonally or annually. Output written to NetCDF for python plotting.

7. <python/plot_map_vars/plot_tropical_dxco2_map_seasonal.py

   - Reads gridded data from NetCDF files in previous step.
   - For single observation mode and single variable, plot seasonal maps.

8. <python/plot_hov_vars/plot_tropical_dxco2_hov_per_surface_4panel.py>

   - Reads gridded data from NetCDF files in previous step.
   - For landH/landM/oceanH, plots Hovmoller of BC dxco2, BC+AK dxco2, xco2 adjustment, BC+AK+Harm dxco2
   
9. <main_6_satellite_vs_tccon.pro>

   - Reads in satellite/tccon collocation file for v9.
   - If v9X (harmonized) is selected, then overwrite XCO2 values from Lite.sav file.
   - Filter/aggregate XCO2.
   - Generate plots per observation mode:
      * One:to:one scatter for all sites combined
      * Time series scatter for all sites combined
      * One:to:one scatter for individual sites
      * Time series scatter for individual sites

10. <main_7_satellite_vs_model.pro>

   - 

11. <main_8_satellite_vs_model_2versions.pro>


XXX. <main_aggregate_gosat_to_nc4_DEFUNCT.py>
   Primary purpose seems to be to generate a single NetCDF output file containing the "original" and "modified" XCO2 values. Subsequent analysis codes seem to use this aggregated file.
   Generates 4 panel plot showing global maps of AOD|dp|XCO2|change in XCO2 for the full GOSAT record.
   The original idea was to use primarily Python for data analysis. But it didn't go as smoothly as planned.
   The features of this code could be wrapped into previous code as Step D.

